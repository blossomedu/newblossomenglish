<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë°˜ë³„ ê²Œì‹œíŒ - ë¸”ë¼ì¸ì‰ê¸€ë¦¬ì‰¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css" rel="stylesheet" />

  <style>
    :root {
      --blue: #00AEEF;
      --mint: #9FE6B8;
      --pink: #FF6FB5;
      --gray: #f3f4f6;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Pretendard Variable", sans-serif;
    }

    body {
      background: #f4f6fb;
      padding: 20px 0 60px;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .title-big {
      font-size: 32px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .subtitle {
      font-size: 15px;
      color: #6b7280;
      margin-bottom: 22px;
    }

    .top-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-bottom: 20px;
    }

    .top-btn {
      padding: 10px 18px;
      border: none;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      color: #fff;
      white-space: nowrap;
    }

    #btn-write { background: var(--mint); }
    #btn-online { background: var(--blue); }
    #btn-admin { background: var(--pink); }

    /* ì¹´ë“œ */
    .post-card {
      background: white;
      border-radius: 26px;
      padding: 22px 26px;
      margin-bottom: 26px;
      box-shadow: 0 15px 32px rgba(15, 23, 42, 0.08);
    }

    .row-space {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .post-title {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 10px;
      margin-right: 20px;
    }

    /* ë™ì¼í•œ ìœ„ì¹˜ì— ë†“ì„ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ */
    .edit-area {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
      margin-bottom: 4px;
    }

    .edit-btn {
      padding: 4px 12px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      background: #ffe4ea;
      color: #d53f8c;
    }

    .delete-btn {
      padding: 4px 12px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      background: #fde2e2;
      color: #b91c1c;
    }

    .tag {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: #ffe4f6;
      color: var(--pink);
      margin-right: 6px;
      font-weight: 600;
    }

    .content-block {
      font-size: 15px;
      color: #374151;
      margin: 6px 0;
      line-height: 1.5;
      white-space: pre-line;
    }

    .small-info {
      margin-top: 10px;
      font-size: 14px;
      color: #6b7280;
      line-height: 1.4;
    }

    .divider {
      height: 1px;
      background: #e5e7eb;
      margin: 18px 0;
    }
  </style>
</head>
<body>
<div class="page">

  <div class="title-big">ë°˜ë³„ ê²Œì‹œíŒ</div>
  <div class="subtitle">ë°˜ì„ ì„ íƒí•˜ê³  ê³µì§€ì™€ ìˆ™ì œë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>

  <label style="font-size:14px;">ë°˜ ì„ íƒ</label>
  <select id="class-select" style="padding:8px 12px; border-radius:999px; margin-left:10px;">
    <option value="">ì „ì²´</option>
  </select>

  <div class="top-buttons">
    <button id="btn-write" class="top-btn">âœï¸ ê¸€ì“°ê¸°</button>
    <button id="btn-online" class="top-btn">ğŸ“š ì˜¨ë¼ì¸ ìˆ™ì œ</button>
    <button id="btn-admin" class="top-btn">ğŸ›  ê´€ë¦¬</button>
  </div>

  <div id="post-list"></div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>
<script>
const client = supabase.createClient(
  "https://bpdisxjhhibrgfpvtlmv.supabase.co",
  "eyJhbGciOiJIUzI1NiIs..."
);

const classSelect = document.getElementById("class-select");
const postList = document.getElementById("post-list");

async function loadClasses() {
  const { data } = await client.from("classes").select("id,name").order("name");
  data.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c.id;
    opt.textContent = c.name;
    classSelect.appendChild(opt);
  });
}

async function loadPosts() {
  const target = classSelect.value || null;

  let query = client.from("board_posts").select("*").order("created_at", { ascending: false });
  if (target) query = query.eq("class_id", target);

  const { data } = await query;

  postList.innerHTML = "";

  data.forEach(post => {
    const div = document.createElement("div");
    div.className = "post-card";

    div.innerHTML = `
      <div class="row-space">
        <div class="post-title">${post.title}</div>
        <div style="font-size:14px;color:#6b7280;">
          ${post.author} Â· ${post.created_at.slice(0,10)}
        </div>
      </div>

      <div class="tag">${post.category}</div>

      ${post.content ? `<div class="content-block">${post.content}</div>` : ""}

      <div class="edit-area">
        <button class="edit-btn" onclick="editPost(${post.id})">ìˆ˜ì •</button>
        <button class="delete-btn" onclick="deletePost(${post.id})">ì‚­ì œ</button>
      </div>

      ${post.level ? `
      <div class="small-info">
        ë‹¨ê³„ ${post.level} / ì„¸íŠ¸ ${post.set_numbers}<br>
        ë§ˆê°ì¼: ${post.due_date}
      </div>` : ""}
    `;

    postList.appendChild(div);
  });
}

classSelect.onchange = loadPosts;
window.onload = async () => {
  await loadClasses();
  await loadPosts();
};

  async function editPost(id) {
  window.location.href = `board-edit.html?id=${id}`;
}

async function deletePost(id) {
  if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ì–´ìš”?")) return;

  const { error } = await client.from("board_posts").delete().eq("id", id);
  if (error) {
    alert("ì‚­ì œ ì‹¤íŒ¨");
    return;
  }
  loadPosts();
}

document.getElementById("btn-write").onclick = () => {
  window.location.href = "board-write.html";
};
document.getElementById("btn-online").onclick = () => {
  window.location.href = "homework-teacher.html";
};
document.getElementById("btn-admin").onclick = () => {
  window.location.href = "admin.html";
};
</script>
</body>
</html>
  

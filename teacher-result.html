<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì„ ìƒë‹˜ ê´€ë¦¬ í˜ì´ì§€ - Blossom English</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    /* === [board.htmlì—ì„œ ê°€ì ¸ì˜¨ ê³µí†µ ìŠ¤íƒ€ì¼] === */
    :root {
      --blue: #00AEEF;
      --mint: #9FE6B8;
      --pink: #FF6FB5;
      --gray-bg: #e5e7eb;
      --gray-text: #374151;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Pretendard Variable", -apple-system, BlinkMacSystemFont,
        system-ui, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
    }

    body {
      background: #f4f6fb;
      padding: 30px 0 60px; /* ìƒë‹¨ ì—¬ë°± í†µì¼ (30px) */
      color: #111827;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* --- íƒ€ì´í‹€ ì˜ì—­ (board.html ìŠ¤íƒ€ì¼) --- */
    .title-big {
      font-size: 34px;
      font-weight: 900;
      margin-bottom: 6px;
      color: #111;
    }

    .subtitle {
      font-size: 16px;
      color: #6b7280;
      margin-bottom: 20px;
    }

    /* --- ìƒë‹¨ ë²„íŠ¼ ì¤„ (board.htmlì˜ .top-bar êµ¬ì¡° ì´ì‹) --- */
    .top-bar {
      display: flex;
      justify-content: flex-end; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
      min-height: 40px;
    }

    .top-btns {
      display: flex;
      gap: 8px;
    }

    .pill-btn {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      transition: opacity 0.2s;
      text-decoration: none;
      font-weight: 600;
    }
    .pill-btn:hover { opacity: 0.9; }

    /* ë²„íŠ¼ ìƒ‰ìƒ (board.htmlê³¼ ë™ì¼) */
    .btn-home { background: #e5e7eb; color: #374151; } /* íšŒìƒ‰ */
    .btn-primary { background: #9fe6b8; color: #ffffff; } /* ë¯¼íŠ¸ (ê¸€ì“°ê¸°) */
    .btn-secondary { background: #00aeef; color: #ffffff; } /* íŒŒë‘ (ìˆ™ì œ) */
    .btn-manage { background: #ff6fb5; color: #ffffff; } /* í•‘í¬ (ê´€ë¦¬) - í˜„ì¬ í˜ì´ì§€ */


    /* === [ê´€ë¦¬ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼] === */
    .section-card { 
      background: white; 
      border-radius: 24px; /* ë‘¥ê¸€ê²Œ í†µì¼ */
      padding: 30px; 
      margin-bottom: 24px; 
      box-shadow: 0 15px 32px rgba(15, 23, 42, 0.08); 
    }
    
    .card-title { 
      font-size: 20px; 
      font-weight: 800; 
      margin-bottom: 20px; 
      color: #374151;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .table-wrap { overflow-x: auto; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; min-width: 700px; }
    th { 
      background: #f9fafb; 
      color: #4b5563; 
      font-weight: 700; 
      text-align: left; 
      padding: 14px; 
      border-bottom: 2px solid #e5e7eb; 
    }
    td { 
      padding: 14px; 
      border-bottom: 1px solid #e5e7eb; 
      vertical-align: middle; 
      color: #374151;
    }
    tr:last-child td { border-bottom: none; }

    /* ì»¨íŠ¸ë¡¤ëŸ¬ (ê²€ìƒ‰ì°½ ë“±) */
    .controls { display: flex; gap: 8px; margin-bottom: 20px; align-items: center; flex-wrap: wrap; }
    
    .input-ui { 
      padding: 10px 14px; 
      border: 1px solid #d1d5db; 
      border-radius: 12px; 
      font-size: 14px; 
      height: 42px; 
      outline: none; 
      background: #fff;
      transition: border-color 0.2s;
    }
    .input-ui:focus { border-color: var(--blue); }

    .btn-search { 
      background: var(--blue); color: white; border: none; 
      padding: 0 24px; border-radius: 12px; font-weight: 700; 
      cursor: pointer; height: 42px; font-size: 14px;
    }
    .btn-search:hover { opacity: 0.9; }

    .btn-search-pink { 
      background: var(--pink); color: white; border: none; 
      padding: 0 24px; border-radius: 12px; font-weight: 700; 
      cursor: pointer; height: 42px; font-size: 14px;
    }
    .btn-search-pink:hover { opacity: 0.9; }

    #studentNameInput, #studentNameInput2 { width: 180px; }

    /* ë±ƒì§€ ìŠ¤íƒ€ì¼ */
    .badge { padding: 4px 10px; border-radius: 99px; font-size: 12px; font-weight: 700; display: inline-block; }
    .badge-done { background: #dcfce7; color: #166534; }
    .badge-yet { background: #f3f4f6; color: #9ca3af; }
    .badge-new { background: #fee2e2; color: #991b1b; }

    .assign-select { 
        padding: 6px 10px; border-radius: 8px; border: 1px solid #d1d5db; font-size: 13px;
    }

    .btn-save {
      padding: 6px 12px;
      background: var(--mint);
      color: #064e3b;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 12px;
      margin-left: 4px;
    }
    .btn-save:hover { opacity: 0.9; }
  </style>
</head>
<body>
<div class="page">
  <div class="title-big">ì„ ìƒë‹˜ ê´€ë¦¬ í˜ì´ì§€</div>
  <div class="subtitle">
    ë‚ ì§œë³„ ìˆ™ì œ ê²€ì‚¬, ë°˜ë³„ í•™ìƒ ì¡°íšŒ ë° ì‹ ì…ìƒ ë°˜ ë°°ì •ì„ í•  ìˆ˜ ìˆì–´ìš”.
  </div>

  <div class="top-bar">
    <div class="top-btns" style="margin-left: auto;"> <button class="pill-btn btn-home" onclick="location.href='index.html'">
        ğŸ  í™ˆ
      </button>
      <button class="pill-btn btn-primary" onclick="location.href='board.html'">
        âœï¸ ê¸€ì“°ê¸°
      </button>
      <button class="pill-btn btn-secondary" onclick="location.href='homework-teacher.html'">
        ğŸ“š ì˜¨ë¼ì¸ ìˆ™ì œ
      </button>
      <button class="pill-btn btn-manage" onclick="location.reload()">
        ğŸ›  ê´€ë¦¬
      </button>
    </div>
  </div>

  <div class="section-card">
    <div class="card-title">ğŸ“… ë‚ ì§œë³„ ìˆ™ì œ ê²€ì‚¬</div>
    <div class="controls">
      <select id="classSelect" class="input-ui">
        <option value="">ë°˜ ì„ íƒ</option>
      </select>

      <input
        type="text"
        id="studentNameInput"
        class="input-ui"
        placeholder="í•™ìƒ ì´ë¦„ (ì„ íƒ)"
      >

      <input type="date" id="dateInput" class="input-ui">

      <button class="btn-search" onclick="loadHomework()">ì¡°íšŒí•˜ê¸°</button>
    </div>

    <div class="table-wrap">
      <table id="homeworkTable">
        <thead>
          <tr>
            <th width="15%">ì´ë¦„</th>
            <th width="15%">ìƒíƒœ</th>
            <th width="20%">ì ìˆ˜ / ëª¨ë“œ</th>
            <th width="20%">ë‹¨ì›(Unit)</th>
            <th width="30%">ì œì¶œ ì‹œê°„</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="5" style="text-align:center; padding:30px; color:#888;">ë°˜ ë˜ëŠ” ì´ë¦„, ë‚ ì§œë¥¼ ì„ íƒí•˜ê³  [ì¡°íšŒí•˜ê¸°]ë¥¼ ëˆ„ë¥´ì„¸ìš”.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="section-card">
    <div class="card-title">ğŸ‘¥ ë°˜ë³„ í•™ìƒ ë³´ê¸°</div>
    <div class="controls">
      <select id="classSelect2" class="input-ui">
        <option value="">ë°˜ ì„ íƒ</option>
      </select>

      <input
        type="text"
        id="studentNameInput2"
        class="input-ui"
        placeholder="í•™ìƒ ì´ë¦„ (ì„ íƒ)"
      >

      <button class="btn-search-pink" onclick="loadStudentsByClass()">ì¡°íšŒí•˜ê¸°</button>
    </div>

    <div class="table-wrap">
      <table id="studentsTable">
        <thead>
          <tr>
            <th width="14%">ì´ë¦„</th>
            <th width="16%">ì•„ì´ë””</th>
            <th width="18%">ì—°ë½ì²˜</th>
            <th width="14%">ë°˜</th>
            <th width="14%">ê°€ì…ì¼</th>
            <th width="14%">ë°˜ ë³€ê²½</th>
            <th width="10%">ì €ì¥</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="7" style="text-align:center; padding:30px; color:#888;">ë°˜ ë˜ëŠ” ì´ë¦„ìœ¼ë¡œ í•™ìƒì„ ì¡°íšŒí•  ìˆ˜ ìˆì–´ìš”.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="section-card">
    <div class="card-title">ğŸŒ± ì‹ ì…ìƒ ë°˜ ë°°ì •í•˜ê¸°</div>
    <div class="table-wrap">
      <table id="newStudentTable">
        <thead>
          <tr><th>ì´ë¦„</th><th>ì•„ì´ë””</th><th>ì—°ë½ì²˜</th><th>ìƒíƒœ</th><th>ë°˜ ì„ íƒ</th><th>ì €ì¥</th></tr>
        </thead>
        <tbody>
          <tr><td colspan="6" style="text-align:center; padding:30px; color:#888;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  // 1. Supabase ì„¤ì •
  const SUPABASE_URL = "https://bpdisxjhhibrgfpvtlmv.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJwZGlzeGpoaGlicmdmcHZ0bG12Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5NTkxODQsImV4cCI6MjA3OTUzNTE4NH0.jDZ6BGirOPuWUnt4ykjhng4PLft2ZjBuYAFzApUnlYU";

  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  let classList = [];

  // ìµœê·¼ ì¡°íšŒ ì¡°ê±´ ì €ì¥
  let lastStudentsQuery = { classId: "", nameFilter: "" };

  document.addEventListener("DOMContentLoaded", async () => {
    // ì˜¤ëŠ˜ ë‚ ì§œ ì„¸íŒ…
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    document.getElementById("dateInput").value = `${yyyy}-${mm}-${dd}`;

    await loadClasses(); // ë°˜ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    loadNewStudents();   // ì‹ ì…ìƒ ê°€ì ¸ì˜¤ê¸°
  });

  // --- [1] ë°˜ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ---
  async function loadClasses() {
    const { data, error } = await supabaseClient.from('classes').select('*').order('name');

    const select1 = document.getElementById("classSelect");
    const select2 = document.getElementById("classSelect2");
    if (select1) select1.innerHTML = '<option value="">ë°˜ ì„ íƒ</option>';
    if (select2) select2.innerHTML = '<option value="">ë°˜ ì„ íƒ</option>';

    if (error) {
      console.error("ë°˜ ëª©ë¡ ì—ëŸ¬:", error);
      return;
    }

    classList = data;

    data.forEach(cls => {
      const opt1 = document.createElement("option");
      opt1.value = cls.id;
      opt1.textContent = cls.name;
      if (select1) select1.appendChild(opt1);

      const opt2 = document.createElement("option");
      opt2.value = cls.id;
      opt2.textContent = cls.name;
      if (select2) select2.appendChild(opt2);
    });
  }

  // --- [2] ì‹ ì…ìƒ(ë°˜ ì—†ëŠ” í•™ìƒ) ê°€ì ¸ì˜¤ê¸° ---
  async function loadNewStudents() {
    const tbody = document.querySelector("#newStudentTable tbody");

    const { data, error } = await supabaseClient
      .from('students')
      .select('*')
      .is('class_id', null)
      .order('created_at', { ascending: false });

    if (error) {
      console.error(error);
      tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:30px; color:#999;">ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜</td></tr>`;
      return;
    }

    tbody.innerHTML = "";
    if (!data || data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:30px; color:#999;">ì‹ ê·œ í•™ìƒ(ë¯¸ë°°ì •)ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
      return;
    }

    data.forEach(student => {
      const tr = document.createElement("tr");

      let options = '<option value="">ì„ íƒ</option>';
      classList.forEach(c => {
        options += `<option value="${c.id}">${c.name}</option>`;
      });

      tr.innerHTML = `
        <td style="font-weight:bold;">${student.name}</td>
        <td>${student.login_id}</td>
        <td>${student.parent_phone || '-'}</td>
        <td><span class="badge badge-new">ë¯¸ë°°ì •</span></td>
        <td><select class="assign-select" id="sel-${student.id}">${options}</select></td>
        <td><button class="btn-save" onclick="saveClass('${student.id}')">ì €ì¥</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  // --- [3] ë°˜ ë°°ì • ì €ì¥ ---
  async function saveClass(studentId) {
    const sel = document.getElementById(`sel-${studentId}`);
    if (!sel.value) { alert("ë°˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }

    const { error } = await supabaseClient
      .from('students')
      .update({ class_id: sel.value })
      .eq('id', studentId);

    if (error) {
      alert("ì €ì¥ ì‹¤íŒ¨: " + error.message);
      return;
    }

    alert("ë°˜ ë°°ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    loadNewStudents();
    if (lastStudentsQuery.classId || lastStudentsQuery.nameFilter) {
      loadStudentsByClass(true);
    }
  }

  // --- [4] ë°˜ë³„ í•™ìƒ ì¡°íšŒ ---
  async function loadStudentsByClass(isRerun = false) {
    const classId = document.getElementById("classSelect2").value;
    const nameFilter = document.getElementById("studentNameInput2").value.trim();
    const tbody = document.querySelector("#studentsTable tbody");

    if (!classId && !nameFilter) {
      alert("ë°˜ ë˜ëŠ” í•™ìƒ ì´ë¦„ ì¤‘ í•˜ë‚˜ëŠ” ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    if (!isRerun) {
      lastStudentsQuery = { classId, nameFilter };
    }

    const activeClassId = isRerun ? lastStudentsQuery.classId : classId;
    const activeNameFilter = isRerun ? lastStudentsQuery.nameFilter : nameFilter;

    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding:30px;">ì¡°íšŒ ì¤‘...</td></tr>`;

    try {
      let query = supabaseClient
        .from('students')
        .select('id, name, login_id, parent_phone, class_id, created_at')
        .order('name');

      if (activeClassId) query = query.eq('class_id', activeClassId);
      if (activeNameFilter) query = query.ilike('name', `%${activeNameFilter}%`);

      const { data: students, error } = await query;
      if (error) throw error;

      tbody.innerHTML = "";

      if (!students || students.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding:30px;">ì¡°ê±´ì— ë§ëŠ” í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      const classNameById = new Map(classList.map(c => [c.id, c.name]));

      students.forEach(s => {
        const tr = document.createElement("tr");
        const className = s.class_id ? (classNameById.get(s.class_id) || s.class_id) : 'ë¯¸ë°°ì •';
        const joinDate = s.created_at ? new Date(s.created_at).toLocaleDateString('ko-KR') : '-';

        let options = `<option value="">ë¯¸ë°°ì •</option>`;
        classList.forEach(c => {
          const selected = s.class_id === c.id ? "selected" : "";
          options += `<option value="${c.id}" ${selected}>${c.name}</option>`;
        });

        tr.innerHTML = `
          <td style="font-weight:700;">${s.name}</td>
          <td>${s.login_id || '-'}</td>
          <td>${s.parent_phone || '-'}</td>
          <td>${className}</td>
          <td>${joinDate}</td>
          <td>
            <select class="assign-select" id="cls-${s.id}">
              ${options}
            </select>
          </td>
          <td>
            <button class="btn-save" onclick="updateStudentClass('${s.id}')">ì €ì¥</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

    } catch (err) {
      console.error(err);
      tbody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding:30px;">ì˜¤ë¥˜: ${err.message}</td></tr>`;
    }
  }

  // --- [4-1] ë°˜ ë³€ê²½ ì €ì¥ ---
  async function updateStudentClass(studentId) {
    const sel = document.getElementById(`cls-${studentId}`);
    if (!sel) return;

    const newClassId = sel.value ? sel.value : null;

    const { error } = await supabaseClient
      .from('students')
      .update({ class_id: newClassId })
      .eq('id', studentId);

    if (error) {
      alert("ì €ì¥ ì‹¤íŒ¨: " + error.message);
      return;
    }

    alert("ë°˜ ë³€ê²½ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    loadNewStudents();
    loadStudentsByClass(true);
  }

  // --- [5] ë‚ ì§œë³„ ìˆ™ì œ ê²€ì‚¬ (ìˆ˜ì •ë¨: ë§ˆê°ì¼ ê¸°ì¤€ ìˆ™ì œ ì°¾ê¸° -> ê²°ê³¼ ë§¤ì¹­) ---
  async function loadHomework() {
    const classId = document.getElementById("classSelect").value;
    const dateVal = document.getElementById("dateInput").value; // ë§ˆê°ì¼
    const nameFilter = document.getElementById("studentNameInput").value.trim();
    const tbody = document.querySelector("#homeworkTable tbody");

    if (!classId) return alert("ë°˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!dateVal) return alert("ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");

    tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:30px;">ìˆ™ì œ ì •ë³´ë¥¼ ì°¾ëŠ” ì¤‘...</td></tr>`;

    try {
      // 1. í•´ë‹¹ ë‚ ì§œ ë§ˆê°ì¸ ìˆ™ì œ ì°¾ê¸°
      const { data: vocabHW } = await supabaseClient.from('vocab_homework').select('set_numbers').eq('class_id', classId).eq('due_date', dateVal);
      const { data: sentenceHW } = await supabaseClient.from('sentence_homework').select('set_numbers').eq('class_id', classId).eq('due_date', dateVal);

      let targetUnits = [];
      (vocabHW || []).forEach(h => targetUnits.push(...String(h.set_numbers).split(',').map(s => s.trim().replace(/\s+/g, ''))));
      (sentenceHW || []).forEach(h => targetUnits.push(...String(h.set_numbers).split(',').map(s => s.trim().replace(/\s+/g, ''))));
      targetUnits = [...new Set(targetUnits)].filter(Boolean);

      if (targetUnits.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:30px; color:#888;">ğŸ“… ${dateVal} ë§ˆê°ì¸ ìˆ™ì œê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      // 2. í•™ìƒ ëª…ë‹¨
      let q = supabaseClient.from('students').select('id, name, login_id').eq('class_id', classId).order('name');
      if (nameFilter) q = q.ilike('name', `%${nameFilter}%`);
      const { data: students } = await q;
      if (!students || !students.length) {
        tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:30px; color:#888;">í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      // 3. ê²°ê³¼ ì¡°íšŒ (ì œì¶œì¼ ë¬´ê´€)
      const loginIds = students.map(s => s.login_id);
      const { data: vResults } = await supabaseClient.from('vocab_results').select('*').in('student_login_id', loginIds).in('unit_key', targetUnits);
      const { data: sResults } = await supabaseClient.from('sentence_results').select('*').in('student_login_id', loginIds).in('unit_key', targetUnits);
      const allResults = [...(vResults||[]), ...(sResults||[])];

      tbody.innerHTML = "";
      students.forEach(std => {
        // ìµœì‹ ìˆœ ì •ë ¬
        const myResults = allResults
          .filter(r => r.student_login_id === std.login_id)
          .sort((a,b) => new Date(b.submitted_at) - new Date(a.submitted_at));
        
        if (myResults.length > 0) {
          myResults.forEach(res => {
            const tr = document.createElement("tr");
            const submitDate = new Date(res.submitted_at);
            const dateStr = submitDate.toISOString().split('T')[0];
            const timeStr = submitDate.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            
            // ì§€ê° ì²´í¬
            const isLate = dateStr > dateVal;
            const timeDisplay = isLate 
              ? `<span style="color:#e11d48; font-weight:bold;">(ì§€ê°)</span> ${dateStr} ${timeStr}`
              : `${dateStr} ${timeStr}`;

            let scoreDisplay = "ì™„ë£Œ";
            if (res.total_count > 0) {
              const score = Math.round((res.correct_count / res.total_count) * 100);
              const color = score === 100 ? "color:#2563eb; font-weight:bold;" : "";
              scoreDisplay = `<span style="${color}">${score}ì </span> <span style="color:#888; font-size:12px;">(${res.correct_count}/${res.total_count})</span>`;
            }
            const modeDisplay = res.mode ? `<span style="color:#6b7280; font-size:12px;">[${res.mode}]</span>` : "";

            tr.innerHTML = `
              <td style="font-weight:700;">${std.name}</td>
              <td><span class="badge badge-done">ì œì¶œ ì™„ë£Œ</span></td>
              <td>${scoreDisplay} ${modeDisplay}</td>
              <td style="font-weight:bold; color:var(--blue);">${res.unit_key || res.unit}</td>
              <td style="color:#374151; font-size:13px;">${timeDisplay}</td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          // ë¯¸ì œì¶œ
          const tr = document.createElement("tr");
          tr.style.backgroundColor = "#fff5f5";
          tr.innerHTML = `
            <td>${std.name}</td>
            <td><span class="badge badge-yet">ë¯¸ì œì¶œ</span></td>
            <td>-</td>
            <td style="color:#999; font-size:12px;">ëŒ€ìƒ: ${targetUnits.join(', ')}</td>
            <td>-</td>
          `;
          tbody.appendChild(tr);
        }
      });

    } catch (e) {
      console.error(e);
      tbody.innerHTML = `<tr><td colspan="5">ì˜¤ë¥˜: ${e.message}</td></tr>`;
    }
  }
</script>
</body>
</html>

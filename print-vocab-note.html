<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>단어 암기장 출력 - 블라썸잉글리쉬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Pretendard Variable", -apple-system, BlinkMacSystemFont,
        system-ui, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
    }
    body {
      background: #ffffff;
      padding: 20px;
    }
    .page {
      max-width: 900px;
      margin: 0 auto;
    }
    h1 {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 16px;
    }
    .info-line {
      font-size: 14px;
      margin-bottom: 8px;
    }
    .word-row {
      border-bottom: 1px solid #e5e7eb;
      padding: 8px 0;
    }
    .word-eng {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .word-blank {
      height: 28px;
      border-bottom: 1px dashed #d1d5db;
      margin-bottom: 4px;
    }
    .word-small {
      font-size: 12px;
      color: #9ca3af;
    }
    .print-tip {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 12px;
    }
    @media print {
      body {
        padding: 0;
      }
      .print-tip {
        display: none;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <h1>단어 암기장</h1>
  <div id="subtitle" class="subtitle"></div>

  <div class="info-line">이름: ____________________________</div>

  <div id="wordContainer"></div>

  <div class="print-tip">
    이 창이 뜨면 브라우저 인쇄(⌘+P / Ctrl+P)로 출력하세요.
  </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>
<script>
  const SUPABASE_URL = "https://bpdisxjhhibrgfpvtlmv.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJwZGlzeGpoaGlicmdmcHZ0bG12Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5NTkxODQsImV4cCI6MjA3OTUzNTE4NH0.jDZ6BGirOPuWUnt4ykjhng4PLft2ZjBuYAFzApUnlYU";

  const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const subtitleEl = document.getElementById("subtitle");
  const container  = document.getElementById("wordContainer");

  const params = new URLSearchParams(window.location.search);
  const levelParam = params.get("level") || "";
  const setsParam  = params.get("sets") || "";
  const setNumbers = setsParam
    .split(",")
    .map(s => s.trim())
    .filter(s => s !== "");

  subtitleEl.textContent =
    `레벨 ${levelParam} / 세트 ${setNumbers.join(", ")} 단어 암기장`;

  async function loadWords() {
    if (!levelParam || setNumbers.length === 0) {
      alert("레벨 또는 세트 정보가 없습니다.");
      return;
    }

    const { data, error } = await client
      .from("vocab_words")
      .select("id, level, set_number, english, korean")
      .eq("level", Number(levelParam))
      .in("set_number", setNumbers.map(n => Number(n)))
      .order("set_number", { ascending: true })
      .order("english", { ascending: true });

    if (error) {
      console.error("단어 불러오기 오류:", error);
      alert("단어를 불러오는 중 오류가 발생했습니다.");
      return;
    }

    container.innerHTML = "";
    (data || []).forEach((row, idx) => {
      const wrap = document.createElement("div");
      wrap.className = "word-row";

      const eng = document.createElement("div");
      eng.className = "word-eng";
      eng.textContent = `${idx + 1}. ${row.english || ""}`;

      const blank = document.createElement("div");
      blank.className = "word-blank";

      const small = document.createElement("div");
      small.className = "word-small";
      small.textContent = "(뜻 쓰기 / 예문 쓰기)";

      wrap.appendChild(eng);
      wrap.appendChild(blank);
      wrap.appendChild(small);

      container.appendChild(wrap);
    });

    setTimeout(() => {
      window.print();
    }, 500);
  }

  loadWords();
</script>
</body>
</html>
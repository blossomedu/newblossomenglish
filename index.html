<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>블라썸잉글리쉬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css" rel="stylesheet" />
  <script src="https://unpkg.com/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>

  <style>
    /* === 스타일 === */
    :root { 
        --main-blue: #00AEEF; /* 관리 버튼 색상 */
        --main-pink: #FF6FB5; 
        --bg: #f4f6fb; 
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Pretendard Variable", sans-serif; }
    body { background: var(--bg); min-height: 100vh; color: #1f2937; }
    .page { max-width: 900px; margin: 0 auto; padding: 32px 16px; }

    /* 헤더 */
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
    .header a { text-decoration: none; color: inherit; }
    .brand-title { font-size: 30px; font-weight: 800; color: #1f2937; } /* 로고 색상 원복 */
    
    /* 사용자 정보 & 버튼 그룹 */
    .user-info { display: flex; align-items: center; gap: 10px; }
    .user-text { font-size: 14px; color: #4b5563; }
    
    /* 관리 버튼 (하늘색 부분 - 요청하신 위치) */
    .admin-btn { 
        padding: 8px 12px; 
        border: none; 
        background: var(--main-blue); /* 00AEEF 색상 */
        color: white; 
        border-radius: 6px; 
        cursor: pointer; 
        font-size: 14px; 
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
    }
    
    .logout-btn { padding: 8px 12px; border: 1px solid #e5e7eb; background: var(--main-pink); color: white; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; }
    .logout-btn:hover { filter: brightness(0.9); }


    /* 카드 그리드 */
    .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; }
    .card { background: white; border-radius: 20px; padding: 30px; text-decoration: none; color: #1f2937; transition: transform 0.2s, box-shadow 0.2s; min-height: 180px; display: flex; flex-direction: column; justify-content: space-between; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1); }
    
    .menu-icon { width: 87px; height: 87px; margin-bottom: 16px; }
    .menu-text { font-size: 20px; font-weight: 700; color: #111827; }
    
    /* 카드별 색상 (사용자의 원본 CSS를 따름) */
    .card:nth-child(1) { border-bottom: 5px solid #ff7eb3; }
    .card:nth-child(2) { border-bottom: 5px solid #6ee7b7; }
    .card:nth-child(3) { border-bottom: 5px solid #00AEEF; }
    .card:nth-child(4) { border-bottom: 5px solid #FF6FB5; } /* 온라인 서점은 핑크 계열 유지 */
    
    /* 숨김 처리 */
    .hidden { display: none !important; }
  </style>
</head>
<body>
<div class="page">
  <div class="header">
    <a href="index.html">
        <div class="brand-title">블라썸잉글리쉬</div>
    </a>
    
    <div class="user-info">
      <div class="user-text" id="userInfoText">로그인 해주세요.</div>
      
      <a href="teacher-result.html" class="admin-btn hidden" id="adminHeaderBtn">관리</a>

      <button class="logout-btn hidden" id="logoutBtn">로그아웃</button>
    </div>
  </div>

  <div class="card-grid">
    <a href="quiz.html?unit=1-1">
      <div class="menu-card">
        <img src="vocab-book.png" class="menu-icon" alt="어휘 학습" />
        <div class="menu-text">어휘 학습</div>
      </div>
    </a>

        <a href="quiz.html?mode=sentence">
      <div class="menu-card">
        <img src="pencil.png" class="menu-icon" alt="문장 학습" />
        <div class="menu-text">문장 학습</div>
      </div>
    </a>

        <a href="board.html">
      <div class="menu-card">
        <img src="board.png" class="menu-icon" alt="반별 게시판" />
        <div class="menu-text">반별 게시판</div>
      </div>
    </a>

        <a id="online-store-link" 
       href="https://search.kyobobook.co.kr/search?keyword=%EC%B4%88%EB%B0%94%EC%98%81&gbCode=TOT&target=total" 
       target="_blank">
      <div class="menu-card" id="online-store-card">
        <img src="store.png" class="menu-icon" alt="온라인 서점" id="card-icon-store" />
        <div class="menu-text" id="card-store-text">온라인 서점</div>
      </div>
    </a>
  </div>
</div>

<script>
  // ---------- Supabase 설정 ----------
  const SUPABASE_URL = "https://bpdisxjhhibrgfpvtlmv.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJwZGlzeGpoaGlicmdmcHZ0bG12Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5NTkxODQsImV4cCI6MjA3OTUzNTE4NH0.jDZ6BGirOPuWUnt4ykjhng4PLft2ZjBuYAFzApUnlYU";
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const userInfoText = document.getElementById("userInfoText");
  const logoutBtn = document.getElementById("logoutBtn");
  const adminHeaderBtn = document.getElementById("adminHeaderBtn"); // ✨ 새 버튼 ID

  // --- 1. 로그인 상태 체크 및 UI 업데이트 ---
  async function checkAuthAndRender() {
    
    // 1. Supabase 세션 확인 (선생님 로그인 체크)
    const { data: { session } } = await supabase.auth.getSession();
    
    // 2. 학생 로그인 확인 (localStorage)
    const studentData = localStorage.getItem("blossom_student");

    if (session) {
      // ✅ 선생님 로그인 상태
      const email = session.user.email;
      
      userInfoText.textContent = `${email.split('@')[0]} 선생님`;
      logoutBtn.classList.remove("hidden");
      adminHeaderBtn.classList.remove("hidden"); // ✨ 헤더 관리 버튼 표시 ✨
      
    } else if (studentData) {
      // ✅ 학생 로그인 상태
      const s = JSON.parse(studentData);
      
      userInfoText.textContent = `${s.name} 학생`;
      logoutBtn.classList.remove("hidden");
      adminHeaderBtn.classList.add("hidden"); // 학생은 관리 버튼 숨김
      
    } else {
      // ❌ 비로그인 상태
      userInfoText.textContent = "로그인 해주세요.";
      logoutBtn.classList.add("hidden");
      adminHeaderBtn.classList.add("hidden"); // 관리 버튼 숨김
    }
  }

  // --- 2. 로그아웃 처리 ---
  async function logoutUser() {
      if(confirm("로그아웃 하시겠습니까?")) {
        localStorage.removeItem("blossom_student"); // 학생 로그아웃
        await supabase.auth.signOut(); // 선생님 로그아웃
        location.reload();
      }
  }
  
  // 로그아웃 버튼 이벤트 리스너 연결
  document.getElementById("logoutBtn").onclick = logoutUser;

  // 페이지 로드 시 실행
  checkAuthAndRender();
</script>
</body>
</html>
